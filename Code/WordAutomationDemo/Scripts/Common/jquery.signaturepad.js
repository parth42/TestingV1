(function(n){function t(t,i){function rt(){clearTimeout(a);a=!1;v=!1}function l(t,i){var o,e,u;if(t.preventDefault(),o=n(t.target).offset(),clearTimeout(a),a=!1,typeof t.targetTouches!="undefined"?(e=Math.floor(t.targetTouches[0].pageX-o.left),u=Math.floor(t.targetTouches[0].pageY-o.top)):(e=Math.floor(t.pageX-o.left),u=Math.floor(t.pageY-o.top)),s.x===e&&s.y===u)return!0;s.x===null&&(s.x=e);s.y===null&&(s.y=u);i&&(u+=i);f.beginPath();f.moveTo(s.x,s.y);f.lineTo(e,u);f.lineCap=r.penCap;f.stroke();f.closePath();h.push({lx:e,ly:u,mx:s.x,my:s.y});s.x=e;s.y=u;r.onDraw&&typeof r.onDraw=="function"&&r.onDraw.apply(k)}function w(){y()}function y(t){t?l(t,1):(d?o.each(function(){this.removeEventListener("touchmove",l)}):o.unbind("mousemove.signaturepad"),h.length>0&&r.onDrawEnd&&typeof r.onDrawEnd=="function"&&r.onDrawEnd.apply(k));s.x=null;s.y=null;r.output&&h.length>0&&n(r.output,u).val(JSON.stringify(h))}function ct(){if(!r.lineWidth)return!1;f.beginPath();f.lineWidth=r.lineWidth;f.strokeStyle=r.lineColour;f.moveTo(r.lineMargin,r.lineTop);f.lineTo(e.width-r.lineMargin,r.lineTop);f.stroke();f.closePath()}function b(){f.clearRect(0,0,e.width,e.height);f.fillStyle=r.bgColour;f.fillRect(0,0,e.width,e.height);r.displayOnly||ct();f.lineWidth=r.penWidth;f.strokeStyle=r.penColour;n(r.output,u).val("");h=[];y()}function ut(n,t){s.x==null?l(n,1):l(n,t)}function ft(n,t){d?t.addEventListener("touchmove",ut,!1):o.bind("mousemove.signaturepad",ut);l(n,1)}function lt(){it=!1;o.each(function(){this.removeEventListener&&(this.removeEventListener("touchend",w),this.removeEventListener("touchcancel",w),this.removeEventListener("touchmove",l));this.ontouchstart&&(this.ontouchstart=null)});n(document).unbind("mouseup.signaturepad");o.unbind("mousedown.signaturepad");o.unbind("mousemove.signaturepad");o.unbind("mouseleave.signaturepad");n(r.clear,u).unbind("click.signaturepad")}function et(t){if(it)return!1;it=!0;n("input").blur();typeof t.targetTouches!="undefined"&&(d=!0);d?(o.each(function(){this.addEventListener("touchend",w,!1);this.addEventListener("touchcancel",w,!1)}),o.unbind("mousedown.signaturepad")):(n(document).bind("mouseup.signaturepad",function(){v&&(y(),rt())}),o.bind("mouseleave.signaturepad",function(n){v&&y(n);v&&!a&&(a=setTimeout(function(){y();rt()},500))}),o.each(function(){this.ontouchstart=null}))}function nt(){n(r.typed,u).hide();b();o.each(function(){this.ontouchstart=function(n){n.preventDefault();v=!0;et(n);ft(n,this)}});o.bind("mousedown.signaturepad",function(n){if(n.preventDefault(),n.which>1)return!1;v=!0;et(n);ft(n)});n(r.clear,u).bind("click.signaturepad",function(n){n.preventDefault();b()});n(r.typeIt,u).bind("click.signaturepad",function(n){n.preventDefault();ot()});n(r.drawIt,u).unbind("click.signaturepad");n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault()});n(r.typeIt,u).removeClass(r.currentClass);n(r.drawIt,u).addClass(r.currentClass);n(r.sig,u).addClass(r.currentClass);n(r.typeItDesc,u).hide();n(r.drawItDesc,u).show();n(r.clear,u).show()}function ot(){b();lt();n(r.typed,u).show();n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault();nt()});n(r.typeIt,u).unbind("click.signaturepad");n(r.typeIt,u).bind("click.signaturepad",function(n){n.preventDefault()});n(r.output,u).val("");n(r.drawIt,u).removeClass(r.currentClass);n(r.typeIt,u).addClass(r.currentClass);n(r.sig,u).removeClass(r.currentClass);n(r.drawItDesc,u).hide();n(r.clear,u).hide();n(r.typeItDesc,u).show();c=p=n(r.typed,u).css("font-size").replace(/px/,"")}function st(t){var i=n(r.typed,u),f=n.trim(t.replace(/>/g,"&gt;").replace(/</g,"&lt;")),o=g,s=c*.5;if(g=f.length,i.html(f),!f){i.css("font-size",p+"px");return}if(g>o&&i.outerWidth()>e.width)while(i.outerWidth()>e.width)c--,i.css("font-size",c+"px");if(g<o&&i.outerWidth()+s<e.width&&c<p)while(i.outerWidth()+s<e.width&&c<p)c++,i.css("font-size",c+"px")}function tt(){var n=[u,r],t=[{drawInvalid:!1,nameInvalid:!1},u,r];return!0}function ht(n,t,i){for(var u in n)typeof n[u]=="object"&&(t.beginPath(),t.moveTo(n[u].mx,n[u].my),t.lineTo(n[u].lx,n[u].ly),t.lineCap=r.penCap,t.stroke(),t.closePath(),i&&h.push({lx:n[u].lx,ly:n[u].ly,mx:n[u].mx,my:n[u].my}))}function at(){parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent)||[0,"4_2"])[1].replace("_","."))<4.1&&(n.fn.Oldoffset=n.fn.offset,n.fn.offset=function(){var t=n(this).Oldoffset();return t.top-=window.scrollY,t.left-=window.scrollX,t});n(r.typed,u).bind("selectstart.signaturepad",function(t){return n(t.target).is(":input")});o.bind("selectstart.signaturepad",function(t){return n(t.target).is(":input")});!e.getContext&&FlashCanvas&&FlashCanvas.initElement(e);e.getContext&&(f=e.getContext("2d"),n(r.sig,u).show(),r.displayOnly||(r.drawOnly||(n(r.name,u).bind("keyup.signaturepad",function(){st(n(this).val())}),n(r.name,u).bind("blur.signaturepad",function(){st(n(this).val())}),n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault();nt()})),r.drawOnly||r.defaultAction==="drawIt"?nt():ot(),r.validateFields&&(n(t).is("form")?n(t).bind("submit.signaturepad",function(){return tt()}):n(t).parents("form").bind("submit.signaturepad",function(){return tt()})),n(r.sigNav,u).show()))}var k=this,r=n.extend({},n.fn.signaturePad.defaults,i),u=n(t),o=n(r.canvas,u),e=o.get(0),f=null,s={x:null,y:null},h=[],a=!1,v=!1,d=!1,it=!1,p=30,c=p,g=0;n.extend(k,{signaturePad:"{{version}}",init:function(){at()},updateOptions:function(t){n.extend(r,t)},regenerate:function(t){k.clearCanvas();n(r.typed,u).hide();typeof t=="string"&&(t=JSON.parse(t));ht(t,f,!0);r.output&&n(r.output,u).length>0&&n(r.output,u).val(JSON.stringify(h))},clearCanvas:function(){b()},getSignature:function(){return h},getSignatureString:function(){return JSON.stringify(h)},getSignatureImage:function(){var n=document.createElement("canvas"),t=null,i=null;return n.style.position="absolute",n.style.top="-999em",n.width=e.width,n.height=e.height,document.body.appendChild(n),!n.getContext&&FlashCanvas&&FlashCanvas.initElement(n),t=n.getContext("2d"),t.fillStyle=r.bgColour,t.fillRect(0,0,e.width,e.height),t.lineWidth=r.penWidth,t.strokeStyle=r.penColour,ht(h,t),i=n.toDataURL.apply(n,arguments),document.body.removeChild(n),n=null,i},validateForm:function(){return tt()}})}n.fn.signaturePad=function(i){var r=null;return this.each(function(){n.data(this,"plugin-signaturePad")?(r=n.data(this,"plugin-signaturePad"),r.updateOptions(i)):(r=new t(this,i),r.init(),n.data(this,"plugin-signaturePad",r))}),r};n.fn.signaturePad.defaults={defaultAction:"typeIt",displayOnly:!1,drawOnly:!1,canvas:"canvas",sig:".sig",sigNav:".sigNav",bgColour:"#ffffff",penColour:"#145394",penWidth:2,penCap:"round",lineColour:"#ccc",lineWidth:2,lineMargin:5,lineTop:35,name:".name",typed:".typed",clear:".clearButton",typeIt:".typeIt a",drawIt:".drawIt a",typeItDesc:".typeItDesc",drawItDesc:".drawItDesc",output:".output",currentClass:"current",validateFields:!0,errorClass:"error",errorMessage:"Please enter your name",errorMessageDraw:"Please sign the document",onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}})(jQuery)